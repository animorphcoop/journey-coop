{% extends "base.html" %}
{% load static %}
{% load django_vite %}

{% block content %}

    <div class="flex flex-col min-h-screen" x-init="console.log('alpine active')">

        <div :class="{ 'hidden': overlay == true}">
            <div class="bg-limey mx-2 my-4 px-8 py-4">
                <p class="text-black text-3xl font-inter font-normal">
                    <button @click="next='start'">
                                <span id="start-button" hx-get="{% url 'start' %}"
                                      hx-target="#journey-overlay"
                                      class="text-black-500 hover:text-blue-800">
                    <button onclick="sayWelcome();"><u>Share</u></button>
                </span>
                    </button>
                    stories about joining a co-operative.
                </p>
            </div>

            {% for journey in journeys %}

                <div class="border bg-grey border-2 grid justify-center items-center p-4 drop-shadow-lg text-gray-800 rounded border-2">

                    <div x-on:click="stopBodyScroll();"
                         hx-get="{% url 'journey_detail' journey.slug %}"
                         hx-target="#journey-overlay"
                         class="cursor-pointer">

                        <div class="font-semibold text-2xl">{{ journey.title }}</div>


                        {% include 'partials/journey_image.html' with journey=journey %}

                        <div class="font-normal text-md">                        {{ journey.summary|truncatewords:5 }}</div>


                    </div>
                </div>
            {% endfor %}
        </div>
        <!--Empty placeholder of all overlays-->
        <div id="journey-overlay"></div>


        <div class="sticky bottom-0 right-0" :class="{ 'hidden': overlay == true}">
            <button @click="next='start'">
      <span hx-get="{% url 'start' %}"
            hx-target="#journey-overlay"
            class="mr-4 bg-limey rounded boarder border-black border-2 p-2 text-grey-500 hover:text-blue-800">
                    Start a Journey
      </span>
            </button>
        </div>

    </div>

    {% block scripts %}

        {% vite_asset 'main/templates/ts/welcome.ts' %}

        <script>

            /*scrolling switch and position logic for handling overlay behaviour*/
            let scrollToPos = 0;
            let monitorScroll = true
            const stopBodyScroll = () => {
                scrollToPos = document.documentElement.style.getPropertyValue('--scroll-y');
                const body = document.body;
                body.style.position = 'fixed';
                monitorScroll = false;
            };
            const enableBodyScroll = () => {
                const body = document.body;
                body.style.position = '';

                setTimeout(
                    function () {
                        window.scrollTo({
                            top: parseInt(scrollToPos),
                            left: 0,
                            behavior: 'auto'
                        });
                        monitorScroll = true;
                    }, 5);


            }

            window.addEventListener('scroll', () => {
                if (monitorScroll) document.documentElement.style.setProperty('--scroll-y', `${window.scrollY}px`);
            });

        </script>

    {% endblock %}

{% endblock %}